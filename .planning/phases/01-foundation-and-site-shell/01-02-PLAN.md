# Plan: 01-02 — Layout Shell & Deployment

**Phase:** 1 — Foundation & Site Shell
**Depends on:** Plan 01-01
**Estimated tasks:** 3

## Goal

A complete site shell with BaseLayout, responsive header (scroll-away + hamburger menu), footer, contact links on every page, dark mode toggle, and a placeholder homepage -- deployed to Cloudflare Pages with CI/CD from GitHub.

## Context

Plan 01-01 established the Astro project, design system tokens, and font configuration. This plan creates the layout components that use those tokens and deploys the result. All components are `.astro` files (zero client JS bundle) -- interactive behavior (scroll-away header, hamburger menu, theme toggle) uses `<script>` tags which Astro handles natively without hydration overhead.

Key user decisions to honor:
- 4 nav items: Home, Articles, Showcase, Contact
- Hamburger menu on mobile, desktop nav visible at `md:` breakpoint
- Header scrolls away on scroll-down, reappears on scroll-up (JS required -- CSS-only is Chromium-only)
- Minimal footer: logo, copyright, contact links -- single line or very compact
- Contact links in BOTH header (compact/icons) and footer (full with text) -- per Claude's discretion for lead generation
- LINE + Email only (no phone)
- Dark mode toggle with light as default, prevent FOUC with `is:inline` script in `<head>`

## Tasks

### Task 1: Create BaseLayout, ThemeToggle, and ContactLinks components

**Do:**

1. Create `src/layouts/BaseLayout.astro` -- the HTML shell used by every page:

   The layout must:
   - Import fonts (`@fontsource-variable/noto-sans-thai`, `@fontsource-variable/inter`) and `global.css`
   - Accept `title` (required) and `description` (optional, default: "AI สำหรับ SME ไทย - เรียนรู้และปรึกษา") props
   - Set `<html lang="th" class="scroll-smooth">`
   - Include `<meta property="og:locale" content="th_TH" />`
   - Include `<link rel="icon" type="image/svg+xml" href="/favicon.svg" />`
   - Include the dark mode FOUC-prevention script using `<script is:inline>` in `<head>` -- this script checks `localStorage.theme` and `prefers-color-scheme` to toggle the `dark` class on `<html>` BEFORE the page renders
   - Body classes: `bg-surface-50 text-surface-900 dark:bg-surface-950 dark:text-surface-100 font-sans antialiased`
   - Body structure: Header component, `<main class="pt-16">` (to offset fixed header height), `<slot />`, Footer component
   - The `pt-16` on main provides space for the fixed header (h-16 = 4rem = pt-16)

2. Create `src/components/common/ThemeToggle.astro`:

   - A button with `aria-label="Toggle dark mode"`
   - Shows a sun icon (visible in dark mode via `hidden dark:block`) and moon icon (visible in light mode via `block dark:hidden`)
   - Use inline SVG for the icons (Heroicons outline style: `sun` and `moon`). Each icon should be `w-5 h-5`.
   - Button styling: `p-2 rounded-lg text-surface-600 hover:bg-surface-200 dark:text-surface-400 dark:hover:bg-surface-800 transition-colors`
   - `<script>` tag (not `is:inline`) that adds a click listener to toggle the `dark` class on `document.documentElement` and persists to `localStorage.theme`

3. Create `src/components/common/ContactLinks.astro`:

   - Accept a `variant` prop: `'compact' | 'full'` (default: `'compact'`)
   - Define constants at the top: `LINE_URL = 'https://line.me/ti/p/~mingrath'` and `EMAIL = 'mailto:mingrath@gmail.com'`
   - **Compact variant** (for header): icons only, `flex items-center gap-2`. Use inline SVG for LINE icon (a simple chat bubble or the LINE logo mark) and email icon (Heroicons envelope outline). Each icon `w-5 h-5`. Links get `p-2 rounded-lg hover:bg-surface-200 dark:hover:bg-surface-800 transition-colors` and appropriate `aria-label` attributes.
   - **Full variant** (for footer): icons + text labels, `flex flex-wrap items-center gap-x-6 gap-y-2 text-sm`. LINE link shows "LINE: @mingrath", email link shows "mingrath@gmail.com". Text color: `text-surface-500 hover:text-primary-600 dark:text-surface-400 dark:hover:text-primary-400 transition-colors`
   - Both variants: LINE link gets `target="_blank" rel="noopener noreferrer"`

**Why:** BaseLayout is the foundation every page uses. ThemeToggle and ContactLinks are shared components needed by Header and Footer.

**Files:**
- `src/layouts/BaseLayout.astro`
- `src/components/common/ThemeToggle.astro`
- `src/components/common/ContactLinks.astro`

### Task 2: Create Header with scroll-away behavior, MobileNav, and Footer

**Do:**

1. Create `src/components/common/Header.astro`:

   - Fixed position header: `fixed top-0 left-0 right-0 z-50`
   - Background with blur: `bg-surface-50/90 dark:bg-surface-950/90 backdrop-blur-sm`
   - Subtle bottom border: `border-b border-surface-200/80 dark:border-surface-800/80`
   - Transition for scroll-away: `transition-transform duration-300`
   - Inner nav container: `max-w-5xl mx-auto px-4 h-16 flex items-center justify-between`
   - Left side: Logo link `<a href="/">` with text "SMEAI" styled as `font-heading font-bold text-xl text-primary-600 dark:text-primary-400`
   - Center/right (desktop, `hidden md:flex`): nav links as `<ul>` with items Home (`/`), Articles (`/articles`), Showcase (`/showcase`), Contact (`/contact`). Style: `items-center gap-6 text-sm font-medium`. Each link: `text-surface-700 hover:text-primary-600 dark:text-surface-300 dark:hover:text-primary-400 transition-colors`
   - Right side: flex container with `ContactLinks variant="compact"` (hidden on mobile: `hidden md:flex`), `ThemeToggle`, and hamburger button (mobile only: `md:hidden`)
   - Hamburger button: `id="menu-toggle"`, `aria-label="Open menu"`, renders a 3-line hamburger SVG icon (`w-6 h-6`)
   - **Scroll-away script** in a `<script>` tag:
     - Track `lastScrollY` and use `requestAnimationFrame` throttling
     - On scroll down past 80px threshold: add `-translate-y-full` class to header
     - On scroll up: remove `-translate-y-full` class
     - This makes the header slide up/out when scrolling down and slide back when scrolling up

2. Create `src/components/common/MobileNav.astro`:

   - Full-screen overlay: `fixed inset-0 z-40 bg-surface-50/98 dark:bg-surface-950/98 backdrop-blur-sm`
   - Initially hidden off-screen: `translate-x-full` with `transition-transform duration-300 ease-in-out md:hidden`
   - Close button in top-right corner (`absolute top-4 right-4`): an X icon button with `id="menu-close"`, `aria-label="Close menu"`
   - Centered nav links: `flex flex-col items-center justify-center h-full gap-8 text-xl font-medium`
   - Same 4 links as desktop: Home, Articles, Showcase, Contact. Each with `data-nav-link` attribute for auto-close behavior
   - Below nav links: a divider (`border-t border-surface-200 dark:border-surface-800`) followed by contact links using `ContactLinks variant="full"`
   - **Script** that:
     - Listens to click on `#menu-toggle` to toggle `translate-x-full` / `translate-x-0` on `#mobile-nav`
     - Listens to click on `#menu-close` to close the menu
     - Listens to click on any `[data-nav-link]` to close the menu after navigation
     - Prevents body scroll when menu is open (`document.body.style.overflow = 'hidden'` / `''`)

3. Create `src/components/common/Footer.astro`:

   - Compact single-band footer: `border-t border-surface-200 dark:border-surface-800`
   - Inner container: `max-w-5xl mx-auto px-4 py-6`
   - Layout: `flex flex-col sm:flex-row items-center justify-between gap-4`
   - Left: Copyright text -- current year, "SMEAI". Style: `text-sm text-surface-500 dark:text-surface-400`
   - Right: `ContactLinks variant="full"`
   - Keep it minimal per user decision -- single line on desktop, stacks on mobile

**Why:** These components complete the site shell visible on every page. The scroll-away header and hamburger menu are core user-decided behaviors. Footer with contact links ensures LEAD-02 (contact accessible from every page).

**Files:**
- `src/components/common/Header.astro`
- `src/components/common/MobileNav.astro`
- `src/components/common/Footer.astro`

### Task 3: Wire up index page, verify build, and deploy to Cloudflare Pages

**Do:**

1. Replace the placeholder `src/pages/index.astro` from Plan 01-01 with a proper page using BaseLayout:
   ```astro
   ---
   import BaseLayout from '../layouts/BaseLayout.astro';
   ---
   <BaseLayout title="Home">
     <section class="prose-container py-20">
       <h1 class="text-3xl md:text-4xl font-bold text-surface-900 dark:text-surface-100 mb-4">
         AI สำหรับ SME ไทย
       </h1>
       <p class="text-lg text-surface-600 dark:text-surface-400 leading-relaxed">
         เรียนรู้การนำ AI มาใช้ในธุรกิจ SME อย่างคุ้มค่า พร้อมตัวอย่างจริงและคำปรึกษาจากผู้เชี่ยวชาญ
       </p>
       <p class="mt-8 text-sm text-surface-400 dark:text-surface-500 italic">
         Site is under construction. Content coming soon.
       </p>
     </section>
   </BaseLayout>
   ```
   This gives the homepage real Thai content to verify typography rendering. The full landing page will be built in Phase 2.

2. Run `npm run build` and verify:
   - Build completes without errors
   - `dist/index.html` exists and contains `lang="th"`, `og:locale` meta tag, font CSS, and the dark mode inline script
   - No `tailwind.config.js` file exists anywhere

3. Run `npm run dev` and manually verify in the browser:
   - Header renders with logo, nav links (desktop), contact icons, theme toggle, and hamburger (mobile)
   - Scrolling down hides the header, scrolling up shows it
   - Hamburger opens mobile nav overlay, close button and link clicks close it
   - Theme toggle switches between light and dark mode, persists on refresh
   - Thai text renders with Noto Sans Thai font at proper line-height
   - Contact links (LINE + email) are visible in both header and footer
   - Footer shows copyright and full contact links
   - Page is responsive: at mobile widths, desktop nav hides and hamburger appears

4. Deploy to Cloudflare Pages:
   - Ensure the GitHub remote is set up: `git remote -v`. If not, add it: `git remote add origin https://github.com/mingrath/smeai.git`
   - Commit all project files and push to `main` branch
   - The Cloudflare Pages project needs to be created in the Cloudflare dashboard (this is a one-time manual step):
     - Go to Workers & Pages > Create > Pages > Connect to Git
     - Select the `smeai` repository
     - Build settings: Framework preset = Astro, Build command = `npm run build`, Build output = `dist`, Production branch = `main`
     - Set environment variable `NODE_VERSION` = `20`
   - After the first deployment succeeds, enable Web Analytics in the Cloudflare dashboard:
     - Go to Workers & Pages > smeai > Metrics > Enable Web Analytics
     - Cloudflare auto-injects the analytics beacon -- no code changes needed

**Why:** This task wires everything together, proves the build works, and gets the site live. Deploying early validates the entire pipeline and creates the CI/CD loop that all future phases depend on.

**Files:**
- `src/pages/index.astro` (updated)
- `dist/` (build output, gitignored)

## Verification

- [ ] `npm run build` succeeds with zero errors
- [ ] `npm run dev` serves the site at `http://localhost:4321` with correct layout
- [ ] Header shows: SMEAI logo, 4 nav links (desktop), contact icons (desktop), theme toggle, hamburger (mobile)
- [ ] Scrolling down past ~80px hides the header; scrolling up shows it again
- [ ] Hamburger button opens full-screen mobile nav; close button and link clicks dismiss it
- [ ] Theme toggle switches light/dark mode; preference persists across page refresh with no FOUC
- [ ] Thai text ("AI สำหรับ SME ไทย") renders with Noto Sans Thai font, line-height is visibly generous (1.8)
- [ ] Contact links (LINE icon + email icon) are visible in the header on desktop
- [ ] Contact links (LINE: @mingrath + mingrath@gmail.com with text) are visible in the footer
- [ ] Footer is compact: copyright + contact links on one line (desktop) or stacked (mobile)
- [ ] Page is mobile-responsive: resize browser to 375px width and verify layout doesn't break
- [ ] `dist/index.html` contains `lang="th"`, `<meta property="og:locale" content="th_TH" />`
- [ ] Site is live on Cloudflare Pages URL (e.g., `smeai.pages.dev`) and shows the same content
- [ ] Cloudflare Web Analytics is enabled and collecting data (check Metrics tab in dashboard)

## Requirements Addressed

- **LAND-03**: Mobile-first responsive design -- hamburger menu on mobile, responsive layout, tested at 375px width
- **LAND-05**: Personal branding tone -- warm approachable design, friendly typography, blue + warm accent colors
- **SEO-04**: Cloudflare Analytics integrated -- cookieless Web Analytics auto-injected by Cloudflare Pages, PDPA-compliant
- **SEO-05**: Self-hosted Noto Sans Thai + Inter fonts via Fontsource -- imported in BaseLayout, used in global.css @theme
- **SEO-07**: Site deployed on Cloudflare Pages with CI/CD from GitHub -- auto-deploys on push to main
- **LEAD-02**: Contact links accessible from every page -- LINE + email in both header (compact) and footer (full)
