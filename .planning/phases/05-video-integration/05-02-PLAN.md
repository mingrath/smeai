---
phase: 05-video-integration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/pages/videos/index.astro
  - src/pages/videos/[slug].astro
  - src/layouts/ArticleLayout.astro
  - src/components/common/Header.astro
  - src/components/common/MobileNav.astro
autonomous: true

must_haves:
  truths:
    - "Video listing page at /videos/ displays all non-draft videos sorted by date with thumbnails, titles, and metadata"
    - "Video detail page at /videos/{slug}/ shows YouTube embed (facade pattern), companion article link, and body content"
    - "Article detail pages show embedded video when a video back-reference exists in frontmatter"
    - "Videos link appears in both desktop and mobile navigation between Showcase and Contact"
  artifacts:
    - path: "src/pages/videos/index.astro"
      provides: "Video listing page"
      contains: "getCollection"
    - path: "src/pages/videos/[slug].astro"
      provides: "Video detail page with dynamic routing"
      contains: "getStaticPaths"
    - path: "src/layouts/ArticleLayout.astro"
      provides: "Article layout with optional video embed"
      contains: "YouTubeFacade"
    - path: "src/components/common/Header.astro"
      provides: "Desktop nav with Videos link"
      contains: "/videos"
    - path: "src/components/common/MobileNav.astro"
      provides: "Mobile nav with Videos link"
      contains: "/videos"
  key_links:
    - from: "src/pages/videos/[slug].astro"
      to: "src/layouts/VideoLayout.astro"
      via: "layout import"
      pattern: "import VideoLayout"
    - from: "src/pages/videos/[slug].astro"
      to: "astro:content"
      via: "getEntry for companionArticle"
      pattern: "getEntry\\(video\\.data\\.companionArticle\\)"
    - from: "src/layouts/ArticleLayout.astro"
      to: "src/components/video/YouTubeFacade.astro"
      via: "conditional video embed"
      pattern: "linkedVideo.*YouTubeFacade"
    - from: "src/components/common/Header.astro"
      to: "/videos"
      via: "nav link"
      pattern: "href=\"/videos\""
---

<objective>
Wire up the video listing page, video detail pages, article-to-video cross-linking, and navigation integration -- completing the full Video Integration phase.

Purpose: Make video content accessible to visitors via browsable listing, detail pages with facade-pattern embeds, bidirectional article links, and top-level navigation.
Output: 2 new page routes, updated ArticleLayout with video embed, updated Header and MobileNav with Videos link.
</objective>

<execution_context>
@/Users/ohmmingrath/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohmmingrath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-video-integration/05-RESEARCH.md
@.planning/phases/05-video-integration/05-01-SUMMARY.md

# Pages to mirror
@src/pages/showcase/index.astro
@src/pages/showcase/[slug].astro

# Files to modify
@src/layouts/ArticleLayout.astro
@src/components/common/Header.astro
@src/components/common/MobileNav.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create video listing page and video detail page routes</name>
  <files>
    src/pages/videos/index.astro
    src/pages/videos/[slug].astro
  </files>
  <action>
    **Step 1: Create `src/pages/videos/index.astro`.**

    Follow the showcase/index.astro pattern exactly. Flat listing (no pagination needed -- small collection like showcase). Filter drafts, sort by pubDate descending:

    ```astro
    ---
    import { getCollection } from 'astro:content';
    import BaseLayout from '../../layouts/BaseLayout.astro';
    import VideoCard from '../../components/video/VideoCard.astro';

    const videos = await getCollection('videos', ({ data }) => !data.draft);
    const sorted = videos.sort(
      (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
    );
    ---

    <BaseLayout title="วิดีโอ" description="วิดีโอสอนการใช้ AI สำหรับธุรกิจ SME ไทย — ดูได้ฟรีไม่มีค่าใช้จ่าย">
      <section class="py-12 md:py-16">
        <div class="max-w-5xl mx-auto px-4">
          <!-- Page header -->
          <div class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-surface-900 dark:text-surface-100 mb-3">
              วิดีโอ
            </h1>
            <p class="text-lg text-surface-600 dark:text-surface-400">
              วิดีโอสอนการใช้ AI สำหรับธุรกิจ SME
            </p>
          </div>

          <!-- Video grid -->
          {sorted.length > 0 ? (
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {sorted.map((video) => (
                <VideoCard video={video} />
              ))}
            </div>
          ) : (
            <div class="text-center py-12">
              <p class="text-surface-500 dark:text-surface-400 text-lg">
                ยังไม่มีวิดีโอ
              </p>
            </div>
          )}
        </div>
      </section>
    </BaseLayout>
    ```

    **Step 2: Create `src/pages/videos/[slug].astro`.**

    Follow the showcase/[slug].astro pattern. Key differences:
    - Uses VideoLayout instead of ProjectLayout
    - Resolves companionArticle via getEntry
    - Videos are a flat collection so `video.id` is already the slug (no `.split('/').pop()` needed)

    ```astro
    ---
    import { getCollection, getEntry, render } from 'astro:content';
    import VideoLayout from '../../layouts/VideoLayout.astro';

    export async function getStaticPaths() {
      const videos = await getCollection('videos', ({ data }) => !data.draft);
      return videos.map((video) => ({
        params: { slug: video.id },
        props: { video },
      }));
    }

    const { video } = Astro.props;
    const { Content, headings, remarkPluginFrontmatter } = await render(video);
    const companionArticle = await getEntry(video.data.companionArticle);
    ---

    <VideoLayout
      video={video}
      companionArticle={companionArticle}
      readingTime={remarkPluginFrontmatter.minutesRead}
    >
      <Content />
    </VideoLayout>
    ```
  </action>
  <verify>
    Run `npm run build` and confirm:
    1. `/videos/` page is generated (check dist/videos/index.html exists)
    2. `/videos/chatgpt-intro/` and `/videos/line-oa-chatbot-setup/` pages are generated
    3. No build errors related to getStaticPaths or getEntry
  </verify>
  <done>
    - /videos/ listing page renders all non-draft videos in a responsive grid
    - /videos/chatgpt-intro/ and /videos/line-oa-chatbot-setup/ detail pages render with YouTube facade embed, companion article link, and body content
    - Empty state shows Thai message when no videos exist
  </done>
</task>

<task type="auto">
  <name>Task 2: Add video embed to ArticleLayout and Videos link to Header and MobileNav</name>
  <files>
    src/layouts/ArticleLayout.astro
    src/components/common/Header.astro
    src/components/common/MobileNav.astro
  </files>
  <action>
    **Step 1: Update `src/layouts/ArticleLayout.astro` to show linked video embed.**

    Add imports at the top of the frontmatter:
    ```typescript
    import { getEntry } from 'astro:content';
    import YouTubeFacade from '../components/video/YouTubeFacade.astro';
    ```

    After the existing `const articleURL = ...` line, add the video resolution logic:
    ```typescript
    const linkedVideo = article.data.video
      ? await getEntry(article.data.video)
      : null;
    ```

    In the template, add a video section between the ArticleMeta component and the TableOfContents. This places the video prominently before the article text:
    ```astro
    {linkedVideo && (
      <div class="mb-8">
        <YouTubeFacade videoId={linkedVideo.data.youtubeId} title={linkedVideo.data.title} />
        <p class="text-sm text-surface-500 dark:text-surface-400 mt-2">
          ดูวิดีโอประกอบ:{' '}
          <a href={`/videos/${linkedVideo.id}/`} class="text-primary-600 dark:text-primary-400 hover:underline">
            {linkedVideo.data.title}
          </a>
        </p>
      </div>
    )}
    ```

    **Step 2: Add "Videos" link to `src/components/common/Header.astro`.**

    In the desktop nav `<ul>`, add a Videos link between the Showcase `<li>` and Contact `<li>`:
    ```html
    <li>
      <a href="/videos" class="text-surface-700 hover:text-primary-600 dark:text-surface-300 dark:hover:text-primary-400 transition-colors">Videos</a>
    </li>
    ```

    **Step 3: Add "Videos" link to `src/components/common/MobileNav.astro`.**

    In the mobile nav, add a Videos link between the Showcase `<a>` and Contact `<a>`:
    ```html
    <a
      href="/videos"
      data-nav-link
      class="text-surface-700 hover:text-primary-600 dark:text-surface-300 dark:hover:text-primary-400 transition-colors"
    >Videos</a>
    ```
    Must include `data-nav-link` attribute so the existing closeMenu event listener triggers on click.
  </action>
  <verify>
    Run `npm run build` and confirm:
    1. Article pages with video references render the YouTube embed (check the generated HTML for chatgpt-for-sme article contains an iframe/srcdoc element)
    2. Article pages without video references render normally (no errors or empty video sections)
    3. Header.astro contains 5 nav items: Home, Articles, Showcase, Videos, Contact
    4. MobileNav.astro contains 5 nav items with Videos between Showcase and Contact
    5. Full build passes with no errors
  </verify>
  <done>
    - Articles with `video` frontmatter reference display YouTube facade embed above the TOC with link to the video detail page
    - Articles without `video` reference render identically to before (no visual change)
    - Header desktop nav shows Videos link between Showcase and Contact
    - MobileNav shows Videos link between Showcase and Contact with data-nav-link attribute
    - Full `npm run build` passes
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with zero errors
2. `/videos/` page exists and shows 2 video cards with thumbnails and play overlays
3. `/videos/chatgpt-intro/` page shows YouTube facade embed, companion article link, and body content
4. `/videos/line-oa-chatbot-setup/` page shows YouTube facade embed, companion article link, and body content
5. `/articles/chatgpt-for-sme/` page shows embedded video above table of contents
6. `/articles/line-oa-chatbot/` page shows embedded video above table of contents
7. Header and MobileNav both show "Videos" navigation link
8. Video detail pages include VideoObject + BreadcrumbList JSON-LD in the HTML head
</verification>

<success_criteria>
- Video listing page at /videos/ displays all videos in responsive grid
- Video detail pages render YouTube facade embed with companion article link
- Article pages with video references show embedded video
- Videos link is in both desktop and mobile navigation
- All pages build successfully and include proper SEO structured data
</success_criteria>

<output>
After completion, create `.planning/phases/05-video-integration/05-02-SUMMARY.md`
</output>
