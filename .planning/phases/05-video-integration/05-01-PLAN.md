---
phase: 05-video-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content.config.ts
  - src/content/videos/chatgpt-intro.md
  - src/content/videos/line-oa-chatbot-setup.md
  - src/content/articles/ai-basics/chatgpt-for-sme.md
  - src/content/articles/tools/line-oa-chatbot.md
  - src/components/video/YouTubeFacade.astro
  - src/components/video/VideoCard.astro
  - src/components/video/CompanionArticleLink.astro
  - src/components/seo/VideoJsonLd.astro
  - src/layouts/VideoLayout.astro
  - package.json
autonomous: true

must_haves:
  truths:
    - "Videos content collection exists with Zod-validated schema including youtubeId, companionArticle reference, and all required fields"
    - "Two seed video entries exist and pass schema validation at build time"
    - "Articles schema has optional video back-reference field"
    - "YouTubeFacade component wraps astro-lazy-youtube-embed with consistent styling"
    - "VideoCard component displays thumbnail, title, date, and description"
    - "VideoJsonLd produces valid VideoObject + BreadcrumbList structured data"
    - "VideoLayout renders video embed, companion article link, metadata, and prose body"
  artifacts:
    - path: "src/content.config.ts"
      provides: "Videos collection definition with reference() cross-linking"
      contains: "videos"
    - path: "src/content/videos/chatgpt-intro.md"
      provides: "First seed video entry"
      contains: "youtubeId"
    - path: "src/content/videos/line-oa-chatbot-setup.md"
      provides: "Second seed video entry"
      contains: "youtubeId"
    - path: "src/components/video/YouTubeFacade.astro"
      provides: "YouTube lazy embed wrapper component"
      contains: "astro-lazy-youtube-embed"
    - path: "src/components/video/VideoCard.astro"
      provides: "Video card for listing grids"
      contains: "CollectionEntry"
    - path: "src/components/seo/VideoJsonLd.astro"
      provides: "VideoObject JSON-LD structured data"
      contains: "VideoObject"
    - path: "src/layouts/VideoLayout.astro"
      provides: "Video detail page layout"
      contains: "YouTubeFacade"
  key_links:
    - from: "src/content/videos/chatgpt-intro.md"
      to: "src/content/articles/ai-basics/chatgpt-for-sme.md"
      via: "companionArticle reference"
      pattern: "companionArticle: ai-basics/chatgpt-for-sme"
    - from: "src/content.config.ts"
      to: "astro:content"
      via: "reference() function"
      pattern: "reference\\(\"articles\"\\)"
    - from: "src/layouts/VideoLayout.astro"
      to: "src/components/video/YouTubeFacade.astro"
      via: "component import"
      pattern: "import YouTubeFacade"
---

<objective>
Set up the videos content collection with cross-references, install the YouTube facade package, create all reusable video components (YouTubeFacade, VideoCard, CompanionArticleLink, VideoJsonLd), build the VideoLayout, and seed 2 video entries with companion article back-references.

Purpose: Establish the complete video data model and component library so that Plan 02 can wire up pages and navigation without needing to create any new components.
Output: Videos collection, 6 new components/layouts, 2 seed video entries, updated article frontmatter.
</objective>

<execution_context>
@/Users/ohmmingrath/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ohmmingrath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-video-integration/05-RESEARCH.md

# Existing patterns to follow
@src/content.config.ts
@src/components/project/ProjectCard.astro
@src/components/seo/ProjectJsonLd.astro
@src/layouts/ProjectLayout.astro
@src/content/articles/ai-basics/chatgpt-for-sme.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install astro-lazy-youtube-embed, define videos collection schema, and seed 2 video entries</name>
  <files>
    package.json
    src/content.config.ts
    src/content/videos/chatgpt-intro.md
    src/content/videos/line-oa-chatbot-setup.md
    src/content/articles/ai-basics/chatgpt-for-sme.md
    src/content/articles/tools/line-oa-chatbot.md
  </files>
  <action>
    **Step 1: Install the YouTube facade package.**
    ```bash
    cd /Users/ohmmingrath/Projects/smeai && npm install astro-lazy-youtube-embed
    ```

    **Step 2: Update `src/content.config.ts` to add videos collection and article back-reference.**

    Import `reference` from `astro:content` alongside `defineCollection`:
    ```typescript
    import { defineCollection, reference } from "astro:content";
    ```

    Add the `videos` collection after `projects`:
    ```typescript
    const videos = defineCollection({
      loader: glob({ pattern: "**/*.md", base: "./src/content/videos" }),
      schema: z.object({
        title: z.string(),
        description: z.string(),
        youtubeId: z.string(),
        duration: z.string().optional(),
        companionArticle: reference("articles"),
        tags: z.array(z.string()).default([]),
        pubDate: z.coerce.date(),
        draft: z.boolean().default(false),
        seoTitle: z.string().optional(),
        seoKeywords: z.array(z.string()).default([]),
      }),
    });
    ```

    Add optional `video` back-reference to the existing `articles` schema (add after `seoKeywords`):
    ```typescript
    video: reference("videos").optional(),
    ```

    Update the exports to include videos:
    ```typescript
    export const collections = { articles, projects, videos };
    ```

    **Step 3: Create `src/content/videos/` directory and seed 2 video entries.**

    Create `src/content/videos/chatgpt-intro.md`:
    ```markdown
    ---
    title: "ChatGPT เบื้องต้น สำหรับเจ้าของธุรกิจ SME"
    description: "สอนใช้ ChatGPT ตั้งแต่เริ่มต้น สำหรับเจ้าของธุรกิจ SME ที่ไม่มีพื้นฐาน IT"
    youtubeId: "dQw4w9WgXcQ"
    duration: "PT12M45S"
    companionArticle: ai-basics/chatgpt-for-sme
    tags: ["chatgpt", "เริ่มต้น", "sme"]
    pubDate: 2026-02-15
    draft: false
    seoTitle: "ChatGPT Tutorial for Thai SME"
    seoKeywords: ["chatgpt tutorial", "sme thai", "ai เริ่มต้น"]
    ---

    ## เนื้อหาในวิดีโอ

    วิดีโอนี้สอนการใช้ ChatGPT ตั้งแต่เริ่มต้น สำหรับเจ้าของธุรกิจ SME ที่ไม่เคยใช้ AI มาก่อน

    ### หัวข้อที่ครอบคลุม

    - ChatGPT คืออะไร? ทำไมเจ้าของ SME ต้องรู้จัก
    - วิธีสมัครและเริ่มใช้งาน
    - เทคนิคการเขียน prompt ให้ได้ผลลัพธ์ตรงใจ
    - ตัวอย่างการใช้จริงในธุรกิจ: ร่างอีเมล ตอบลูกค้า เขียนคอนเทนต์

    ### ใครควรดูวิดีโอนี้

    เจ้าของธุรกิจ SME ที่อยากเริ่มใช้ AI แต่ไม่รู้จะเริ่มจากตรงไหน ไม่ต้องมีพื้นฐานเทคโนโลยี
    ```

    Create `src/content/videos/line-oa-chatbot-setup.md`:
    ```markdown
    ---
    title: "สร้าง Chatbot LINE OA ด้วย AI แบบไม่ต้องเขียนโค้ด"
    description: "สอนสร้าง chatbot สำหรับ LINE Official Account โดยใช้เครื่องมือ AI ทำได้เองไม่ต้องจ้างโปรแกรมเมอร์"
    youtubeId: "ScMzIvxBSi4"
    duration: "PT18M30S"
    companionArticle: tools/line-oa-chatbot
    tags: ["line-oa", "chatbot", "no-code", "automation"]
    pubDate: 2026-02-17
    draft: false
    seoTitle: "LINE OA AI Chatbot No-Code Tutorial"
    seoKeywords: ["line oa chatbot", "chatbot ai no code", "line official account bot"]
    ---

    ## เนื้อหาในวิดีโอ

    วิดีโอนี้สอนขั้นตอนการสร้าง chatbot บน LINE Official Account แบบ step-by-step โดยไม่ต้องเขียนโค้ดแม้แต่บรรทัดเดียว

    ### หัวข้อที่ครอบคลุม

    - ทำไม LINE OA ถึงสำคัญสำหรับ SME ไทย
    - เครื่องมือ AI สำเร็จรูปที่ใช้สร้าง chatbot ได้ฟรี
    - การตั้งค่า webhook และเชื่อมต่อกับ LINE OA
    - ทดสอบ chatbot และปรับแต่งคำตอบ

    ### ใครควรดูวิดีโอนี้

    เจ้าของ SME ที่มี LINE OA อยู่แล้ว และอยากให้ตอบลูกค้าอัตโนมัติ ไม่ต้องมีความรู้ด้านเขียนโค้ด
    ```

    **Step 4: Update existing article frontmatter with video back-references.**

    In `src/content/articles/ai-basics/chatgpt-for-sme.md`, add `video: chatgpt-intro` to the frontmatter (after `seoKeywords`).

    In `src/content/articles/tools/line-oa-chatbot.md`, add `video: line-oa-chatbot-setup` to the frontmatter (after `seoKeywords`).
  </action>
  <verify>
    Run `npm run build` to confirm:
    1. No schema validation errors (videos collection and updated articles schema both pass)
    2. `reference("articles")` correctly resolves `companionArticle` values
    3. `reference("videos")` correctly resolves `video` back-reference values
    4. Build completes without errors
  </verify>
  <done>
    - `astro-lazy-youtube-embed` is installed in package.json
    - Videos collection defined in content.config.ts with all fields from research schema
    - Articles schema has optional `video: reference("videos")` field
    - 2 seed video .md files exist with valid frontmatter
    - 2 existing article .md files updated with `video` back-reference
    - `npm run build` passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create video components (YouTubeFacade, VideoCard, CompanionArticleLink, VideoJsonLd) and VideoLayout</name>
  <files>
    src/components/video/YouTubeFacade.astro
    src/components/video/VideoCard.astro
    src/components/video/CompanionArticleLink.astro
    src/components/seo/VideoJsonLd.astro
    src/layouts/VideoLayout.astro
  </files>
  <action>
    **Step 1: Create `src/components/video/YouTubeFacade.astro`.**

    A thin wrapper around `astro-lazy-youtube-embed` for consistent styling:
    ```astro
    ---
    import { YouTube } from 'astro-lazy-youtube-embed';

    interface Props {
      videoId: string;
      title: string;
    }

    const { videoId, title } = Astro.props;
    ---

    <div class="aspect-video rounded-xl overflow-hidden">
      <YouTube
        videoId={videoId}
        title={title}
        thumbnailRes="sd"
      />
    </div>
    ```
    Uses `thumbnailRes="sd"` (640px) which is always available (avoids maxresdefault breakage on lower-res uploads). Privacy-enhanced mode is the default (youtube-nocookie.com).

    **Step 2: Create `src/components/video/VideoCard.astro`.**

    Follow the ProjectCard.astro pattern exactly. Key differences: YouTube thumbnail instead of project thumbnail, play button overlay, no industry badge or metric row.

    ```astro
    ---
    import type { CollectionEntry } from 'astro:content';

    interface Props {
      video: CollectionEntry<'videos'>;
    }

    const { video } = Astro.props;
    const { data } = video;
    const slug = video.id;
    const thumbnailUrl = `https://i.ytimg.com/vi/${data.youtubeId}/hqdefault.jpg`;

    const dateFormatted = data.pubDate.toLocaleDateString('th-TH', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    });
    ---

    <a
      href={`/videos/${slug}/`}
      class="group block rounded-xl bg-surface-100 dark:bg-surface-800/50 border border-surface-200 dark:border-surface-700 hover:border-primary-300 dark:hover:border-primary-600 transition-colors overflow-hidden"
    >
      <!-- Thumbnail with play button overlay -->
      <div class="aspect-video relative overflow-hidden">
        <img
          src={thumbnailUrl}
          alt={data.title}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
          loading="lazy"
        />
        <!-- Play button overlay -->
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center shadow-lg group-hover:bg-red-700 transition-colors">
            <svg class="w-7 h-7 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Content area -->
      <div class="p-5">
        <time datetime={data.pubDate.toISOString()} class="text-xs text-surface-400 dark:text-surface-500">
          {dateFormatted}
        </time>
        <h3 class="text-lg font-semibold text-surface-900 dark:text-surface-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors mt-1 mb-2 line-clamp-2">
          {data.title}
        </h3>
        <p class="text-sm text-surface-600 dark:text-surface-400 line-clamp-2 leading-relaxed">
          {data.description}
        </p>
      </div>
    </a>
    ```
    Note: For videos (flat collection), `video.id` is already the slug (e.g., `chatgpt-intro`). No `.split('/').pop()` needed.

    **Step 3: Create `src/components/video/CompanionArticleLink.astro`.**

    A link component that renders a styled link to the companion article:
    ```astro
    ---
    import type { CollectionEntry } from 'astro:content';

    interface Props {
      article: CollectionEntry<'articles'>;
    }

    const { article } = Astro.props;
    const articleSlug = article.id.split('/').pop()!;
    ---

    <a
      href={`/articles/${articleSlug}/`}
      class="group flex items-center gap-3 rounded-xl bg-surface-100 dark:bg-surface-800/50 border border-surface-200 dark:border-surface-700 hover:border-primary-300 dark:hover:border-primary-600 p-4 transition-colors"
    >
      <!-- Article icon -->
      <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center">
        <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
        </svg>
      </div>

      <!-- Text -->
      <div class="flex-1 min-w-0">
        <p class="text-xs text-surface-500 dark:text-surface-400 mb-0.5">บทความประกอบ</p>
        <p class="text-sm font-medium text-surface-900 dark:text-surface-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors truncate">
          {article.data.title}
        </p>
      </div>

      <!-- Arrow -->
      <svg class="w-4 h-4 flex-shrink-0 text-surface-400 dark:text-surface-500 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
      </svg>
    </a>
    ```
    SVGs are inlined Heroicons (document-text and arrow-right), following the established project pattern of no icon library dependency.

    **Step 4: Create `src/components/seo/VideoJsonLd.astro`.**

    Follow the ProjectJsonLd.astro pattern. Uses `@graph` array with VideoObject + BreadcrumbList:
    ```astro
    ---
    interface Props {
      title: string;
      description: string;
      youtubeId: string;
      pubDate: Date;
      duration?: string;
      url: string;
      tags: string[];
    }

    const { title, description, youtubeId, pubDate, duration, url, tags } = Astro.props;

    const thumbnailUrl = `https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg`;
    const embedUrl = `https://www.youtube-nocookie.com/embed/${youtubeId}`;

    const schema = {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "VideoObject",
          "name": title,
          "description": description,
          "thumbnailUrl": thumbnailUrl,
          "uploadDate": pubDate.toISOString().substring(0, 10),
          ...(duration && { "duration": duration }),
          "embedUrl": embedUrl,
          "author": {
            "@type": "Person",
            "name": "Mingrath Mekavichai",
          },
          "publisher": {
            "@type": "Organization",
            "name": "SMEAI",
            "url": Astro.site?.href,
          },
          "mainEntityOfPage": url,
          "keywords": tags,
          "inLanguage": "th",
        },
        {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "หน้าแรก",
              "item": new URL("/", Astro.site).href,
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "วิดีโอ",
              "item": new URL("/videos/", Astro.site).href,
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": title,
            },
          ],
        },
      ],
    };
    ---

    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    ```
    Uses `set:html={JSON.stringify(schema)}` per established JSON-LD pattern to avoid entity escaping.

    **Step 5: Create `src/layouts/VideoLayout.astro`.**

    Follows ProjectLayout.astro structure: BaseLayout > article wrapper > content sections. Includes YouTubeFacade embed, companion article link, metadata, tags, and prose body.

    ```astro
    ---
    import BaseLayout from './BaseLayout.astro';
    import VideoJsonLd from '../components/seo/VideoJsonLd.astro';
    import YouTubeFacade from '../components/video/YouTubeFacade.astro';
    import CompanionArticleLink from '../components/video/CompanionArticleLink.astro';
    import type { CollectionEntry } from 'astro:content';

    interface Props {
      video: CollectionEntry<'videos'>;
      companionArticle: CollectionEntry<'articles'>;
      readingTime: number;
    }

    const { video, companionArticle, readingTime } = Astro.props;
    const { data } = video;

    const pageTitle = data.seoTitle || data.title;
    const videoURL = new URL(Astro.url.pathname, Astro.site).href;

    const dateFormatted = data.pubDate.toLocaleDateString('th-TH', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    });
    ---

    <BaseLayout
      title={pageTitle}
      description={data.description}
      ogType="video.other"
      publishedTime={data.pubDate}
      tags={data.tags}
    >
      <VideoJsonLd
        title={data.title}
        description={data.description}
        youtubeId={data.youtubeId}
        pubDate={data.pubDate}
        duration={data.duration}
        url={videoURL}
        tags={data.tags}
      />

      <article class="py-12 md:py-16">
        <div class="prose-container">
          <!-- Video title -->
          <h1 class="text-3xl md:text-4xl font-bold text-surface-900 dark:text-surface-100 mb-6 leading-tight">
            {data.title}
          </h1>

          <!-- Meta row: date, reading time -->
          <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-surface-500 dark:text-surface-400 mb-6">
            <time datetime={data.pubDate.toISOString()}>
              {dateFormatted}
            </time>
            <span>&middot;</span>
            <span>{readingTime} นาทีในการอ่าน</span>
          </div>

          <!-- YouTube embed (facade pattern) -->
          <div class="mb-8">
            <YouTubeFacade videoId={data.youtubeId} title={data.title} />
          </div>

          <!-- Companion article link -->
          <div class="mb-8">
            <CompanionArticleLink article={companionArticle} />
          </div>

          <!-- Prose body (video summary/notes) -->
          <div class="prose prose-lg dark:prose-invert max-w-none">
            <slot />
          </div>

          <!-- Tags -->
          {data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-8">
              {data.tags.map((tag) => (
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-100 dark:bg-surface-800 text-surface-600 dark:text-surface-400 border border-surface-200 dark:border-surface-700">
                  {tag}
                </span>
              ))}
            </div>
          )}

          <!-- Back to videos link -->
          <div class="mt-12 pt-6 border-t border-surface-200 dark:border-surface-700">
            <a
              href="/videos/"
              class="inline-flex items-center gap-2 text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium transition-colors"
            >
              <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
              </svg>
              กลับไปหน้าวิดีโอ
            </a>
          </div>
        </div>
      </article>
    </BaseLayout>
    ```
    Uses `ogType="video.other"` for proper Open Graph video type. No TableOfContents (video summaries are short, same reasoning as ProjectLayout).
  </action>
  <verify>
    Run `npm run build` to confirm:
    1. All 5 new .astro files are syntactically valid
    2. The `astro-lazy-youtube-embed` import resolves
    3. TypeScript types resolve (`CollectionEntry<'videos'>`, etc.)
    4. Build completes without errors
  </verify>
  <done>
    - YouTubeFacade.astro wraps astro-lazy-youtube-embed with aspect-video + rounded styling
    - VideoCard.astro displays YouTube thumbnail, play overlay, date, title, description
    - CompanionArticleLink.astro renders styled link to companion article with icon
    - VideoJsonLd.astro outputs VideoObject + BreadcrumbList JSON-LD
    - VideoLayout.astro renders full video detail page (embed + companion link + prose body + tags + back link)
    - All components follow established project patterns (Heroicons inline SVGs, Thai date formatting, dark mode classes, OKLCH colors)
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with zero errors
2. Videos collection exists in content.config.ts with all required fields
3. 2 seed videos pass Zod schema validation
4. Articles schema accepts optional `video` back-reference
5. All 5 new component/layout files exist and are syntactically valid
</verification>

<success_criteria>
- Videos content collection is fully defined with cross-references to articles
- 2 seed video entries exist with valid frontmatter linking to existing articles
- 2 existing articles have video back-references in frontmatter
- YouTubeFacade, VideoCard, CompanionArticleLink, VideoJsonLd, and VideoLayout all exist
- `npm run build` passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-video-integration/05-01-SUMMARY.md`
</output>
