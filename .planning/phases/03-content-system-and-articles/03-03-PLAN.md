# Phase 3, Plan 03: Article Listing & Category Browsing

**Phase Goal**: Ohm can publish Thai-language articles via Markdown with validated frontmatter, and visitors can browse articles by category, read with a polished experience, and subscribe via RSS
**Plan Scope**: Create article card component, pagination component, paginated article listing page, and category-filtered listing page with pagination
**Requirements**: CONT-01 (browse by categories and tags), CONT-06 (article listing with pagination/filtering by category)
**Depends on**: 03-02 (article pages, ArticleLayout, BaseLayout SEO enhancements)

## Context

Plan 01 established the content collection, seed articles, RSS, and sitemap. Plan 02 created the article reading experience with TOC, reading time, SEO meta, and JSON-LD. This plan completes the browsing experience: visitors can see all articles in a card grid, paginate through them, and filter by category.

Key references:
- `@src/layouts/BaseLayout.astro` -- enhanced in Plan 02, used for listing pages
- `@src/lib/categories.ts` -- created in Plan 01, used for category display names and nav
- `@src/content.config.ts` -- created in Plan 01, defines the articles collection
- `@.planning/phases/03-content-system-and-articles/03-RESEARCH.md` -- paginate() patterns

## Tasks

### Task 1: Create ArticleCard and Pagination Components

**What:** Create the reusable ArticleCard component (for listing grids) and the Pagination component (for prev/next page navigation).

**Why:** Both are shared components used by both the main article listing page and the category listing page. Building them first avoids duplication.

**Files:**
- `src/components/article/ArticleCard.astro` -- create article card for listing grids
- `src/components/article/Pagination.astro` -- create pagination navigation component

**Details:**

**Step 1: Create `src/components/article/ArticleCard.astro`**

A card component that displays: article title, description (truncated), category badge, publish date, reading time, and tags. Links to the article page. Uses the design system colors (surface, primary, accent). Mobile-first responsive design.

The card receives a `CollectionEntry<'articles'>` and an optional `readingTime` number. Since we cannot call `render()` for every article on the listing page (too expensive), we do NOT show reading time on cards. The reading time is only shown on the individual article page. Instead, show the date and category.

Actually, we CAN estimate reading time without calling render. But for simplicity and performance on listing pages, we skip it and just show date + category.

```astro
---
import { getCategoryName } from '../../lib/categories';
import type { CollectionEntry } from 'astro:content';

interface Props {
  article: CollectionEntry<'articles'>;
}

const { article } = Astro.props;
const { data } = article;
const slug = article.id.split('/').pop()!;

const dateFormatted = data.pubDate.toLocaleDateString('th-TH', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});
---

<a
  href={`/articles/${slug}/`}
  class="group block rounded-xl bg-surface-100 dark:bg-surface-800/50 border border-surface-200 dark:border-surface-700 hover:border-primary-300 dark:hover:border-primary-600 transition-colors overflow-hidden"
>
  <div class="p-5">
    <!-- Category + Date row -->
    <div class="flex items-center justify-between gap-2 mb-3">
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300">
        {getCategoryName(data.category)}
      </span>
      <time datetime={data.pubDate.toISOString()} class="text-xs text-surface-400 dark:text-surface-500">
        {dateFormatted}
      </time>
    </div>

    <!-- Title -->
    <h3 class="text-lg font-semibold text-surface-900 dark:text-surface-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors mb-2 line-clamp-2">
      {data.title}
    </h3>

    <!-- Description -->
    <p class="text-sm text-surface-600 dark:text-surface-400 line-clamp-3 mb-4 leading-relaxed">
      {data.description}
    </p>

    <!-- Tags -->
    {data.tags.length > 0 && (
      <div class="flex flex-wrap gap-1.5">
        {data.tags.slice(0, 3).map((tag) => (
          <span class="inline-flex items-center px-2 py-0.5 rounded text-xs bg-surface-200 dark:bg-surface-700 text-surface-500 dark:text-surface-400">
            #{tag}
          </span>
        ))}
        {data.tags.length > 3 && (
          <span class="text-xs text-surface-400 dark:text-surface-500">
            +{data.tags.length - 3}
          </span>
        )}
      </div>
    )}
  </div>
</a>
```

Note: `line-clamp-2` and `line-clamp-3` are built-in Tailwind v4 utilities -- no plugin needed.

**Step 2: Create `src/components/article/Pagination.astro`**

Takes the Astro `page` object (from `paginate()`) and renders prev/next links with page indicator. The `page` object has: `page.url.prev`, `page.url.next`, `page.currentPage`, `page.lastPage`.

```astro
---
interface Props {
  prevUrl: string | undefined;
  nextUrl: string | undefined;
  currentPage: number;
  lastPage: number;
}

const { prevUrl, nextUrl, currentPage, lastPage } = Astro.props;
---

{lastPage > 1 && (
  <nav aria-label="การแบ่งหน้า" class="flex items-center justify-center gap-4 mt-12">
    {prevUrl ? (
      <a
        href={prevUrl}
        class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-surface-700 dark:text-surface-300 bg-surface-100 dark:bg-surface-800 hover:bg-surface-200 dark:hover:bg-surface-700 border border-surface-200 dark:border-surface-700 transition-colors"
      >
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
        </svg>
        ก่อนหน้า
      </a>
    ) : (
      <span class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-surface-400 dark:text-surface-600 cursor-not-allowed">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
        </svg>
        ก่อนหน้า
      </span>
    )}

    <span class="text-sm text-surface-500 dark:text-surface-400">
      หน้า {currentPage} จาก {lastPage}
    </span>

    {nextUrl ? (
      <a
        href={nextUrl}
        class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-surface-700 dark:text-surface-300 bg-surface-100 dark:bg-surface-800 hover:bg-surface-200 dark:hover:bg-surface-700 border border-surface-200 dark:border-surface-700 transition-colors"
      >
        ถัดไป
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </a>
    ) : (
      <span class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-surface-400 dark:text-surface-600 cursor-not-allowed">
        ถัดไป
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </span>
    )}
  </nav>
)}
```

**Verification:**
- [ ] Both component files exist and have no TypeScript errors
- [ ] Components follow existing design system (surface, primary colors, dark mode variants)
- [ ] Pagination shows Thai text ("ก่อนหน้า", "ถัดไป", "หน้า X จาก Y")
- [ ] ArticleCard uses `line-clamp` for text truncation
- [ ] ArticleCard links to `/articles/{slug}/` matching the route from Plan 02

---

### Task 2: Create Article Listing Page and Category Listing Page

**What:** Create the paginated article listing at `/articles/` and the category-filtered listing at `/articles/category/{category}/`, both using Astro's `paginate()` function.

**Why:** CONT-06 requires article listing with pagination. CONT-01 requires browsing by categories. These are the main discovery entry points for readers.

**Files:**
- `src/pages/articles/[...page].astro` -- create main article listing with pagination
- `src/pages/articles/category/[category]/[...page].astro` -- create category-filtered listing

**Details:**

**Step 1: Create `src/pages/articles/[...page].astro`**

This is the main article listing page. Uses `[...page].astro` (rest param) so the first page renders at `/articles/` and subsequent pages at `/articles/2/`, `/articles/3/`, etc. Uses `paginate()` with `pageSize: 12`. Sorts articles by pubDate descending. Includes category filter links at the top. Uses the ArticleCard and Pagination components.

IMPORTANT: The file must be named `[...page].astro` (with rest param `...`) NOT `[page].astro`. Without the rest param, the first page would be at `/articles/1/` instead of `/articles/`.

```astro
---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleCard from '../../components/article/ArticleCard.astro';
import Pagination from '../../components/article/Pagination.astro';
import { CATEGORIES } from '../../lib/categories';
import type { GetStaticPathsOptions } from 'astro';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const articles = await getCollection('articles', ({ data }) => !data.draft);
  const sorted = articles.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );
  return paginate(sorted, { pageSize: 12 });
}

const { page } = Astro.props;
---

<BaseLayout title="บทความ" description="บทความเกี่ยวกับ AI สำหรับธุรกิจ SME ไทย - เรียนรู้วิธีใช้ AI ในธุรกิจจริง">
  <section class="py-12 md:py-16">
    <div class="max-w-5xl mx-auto px-4">
      <!-- Page header -->
      <div class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-surface-900 dark:text-surface-100 mb-3">
          บทความ
        </h1>
        <p class="text-lg text-surface-600 dark:text-surface-400">
          เรียนรู้วิธีนำ AI มาใช้ในธุรกิจ SME อย่างคุ้มค่าและเป็นรูปธรรม
        </p>
      </div>

      <!-- Category filters -->
      <div class="flex flex-wrap gap-2 mb-8">
        <a
          href="/articles/"
          class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-primary-600 text-white dark:bg-primary-500"
        >
          ทั้งหมด
        </a>
        {Object.entries(CATEGORIES).map(([slug, name]) => (
          <a
            href={`/articles/category/${slug}/`}
            class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-surface-100 dark:bg-surface-800 text-surface-700 dark:text-surface-300 hover:bg-surface-200 dark:hover:bg-surface-700 border border-surface-200 dark:border-surface-700 transition-colors"
          >
            {name}
          </a>
        ))}
      </div>

      <!-- Article grid -->
      {page.data.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {page.data.map((article) => (
            <ArticleCard article={article} />
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-surface-500 dark:text-surface-400 text-lg">
            ยังไม่มีบทความ
          </p>
        </div>
      )}

      <!-- Pagination -->
      <Pagination
        prevUrl={page.url.prev}
        nextUrl={page.url.next}
        currentPage={page.currentPage}
        lastPage={page.lastPage}
      />
    </div>
  </section>
</BaseLayout>
```

**Step 2: Create `src/pages/articles/category/[category]/[...page].astro`**

Category-filtered listing page. Uses `getStaticPaths()` to generate paths for each category, each with pagination. The `[category]` param is the category slug, `[...page]` is the rest param for pagination. Shows the category display name in the page title. Has a "ดูทั้งหมด" (View All) link back to the main listing. The active category is highlighted differently in the filter buttons.

```astro
---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import ArticleCard from '../../../../components/article/ArticleCard.astro';
import Pagination from '../../../../components/article/Pagination.astro';
import { CATEGORIES, getCategoryName } from '../../../../lib/categories';
import type { CategorySlug } from '../../../../lib/categories';
import type { GetStaticPathsOptions } from 'astro';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const articles = await getCollection('articles', ({ data }) => !data.draft);
  const categorySlugs = Object.keys(CATEGORIES) as CategorySlug[];

  return categorySlugs.flatMap((category) => {
    const filtered = articles
      .filter((a) => a.data.category === category)
      .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

    return paginate(filtered, {
      params: { category },
      pageSize: 12,
    });
  });
}

const { page } = Astro.props;
const { category } = Astro.params;
const categoryName = getCategoryName(category as CategorySlug);
---

<BaseLayout
  title={`${categoryName} - บทความ`}
  description={`บทความเกี่ยวกับ${categoryName}สำหรับ SME ไทย`}
>
  <section class="py-12 md:py-16">
    <div class="max-w-5xl mx-auto px-4">
      <!-- Page header -->
      <div class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-surface-900 dark:text-surface-100 mb-3">
          {categoryName}
        </h1>
        <p class="text-lg text-surface-600 dark:text-surface-400">
          บทความในหมวดหมู่ {categoryName}
        </p>
      </div>

      <!-- Category filters -->
      <div class="flex flex-wrap gap-2 mb-8">
        <a
          href="/articles/"
          class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-surface-100 dark:bg-surface-800 text-surface-700 dark:text-surface-300 hover:bg-surface-200 dark:hover:bg-surface-700 border border-surface-200 dark:border-surface-700 transition-colors"
        >
          ทั้งหมด
        </a>
        {Object.entries(CATEGORIES).map(([slug, name]) => (
          <a
            href={`/articles/category/${slug}/`}
            class:list={[
              'inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium transition-colors',
              slug === category
                ? 'bg-primary-600 text-white dark:bg-primary-500'
                : 'bg-surface-100 dark:bg-surface-800 text-surface-700 dark:text-surface-300 hover:bg-surface-200 dark:hover:bg-surface-700 border border-surface-200 dark:border-surface-700',
            ]}
          >
            {name}
          </a>
        ))}
      </div>

      <!-- Article grid -->
      {page.data.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {page.data.map((article) => (
            <ArticleCard article={article} />
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-surface-500 dark:text-surface-400 text-lg">
            ยังไม่มีบทความในหมวดนี้
          </p>
        </div>
      )}

      <!-- Pagination -->
      <Pagination
        prevUrl={page.url.prev}
        nextUrl={page.url.next}
        currentPage={page.currentPage}
        lastPage={page.lastPage}
      />
    </div>
  </section>
</BaseLayout>
```

**Verification:**
- [ ] `npm run build` passes with no errors
- [ ] Build output includes `dist/articles/index.html` (main listing, page 1)
- [ ] Build output includes `dist/articles/category/ai-basics/index.html`
- [ ] Build output includes `dist/articles/category/tools/index.html`
- [ ] Main listing shows both seed articles in card format
- [ ] Category listing for "ai-basics" shows only the ChatGPT article
- [ ] Category listing for "tools" shows only the LINE OA article
- [ ] Category filter buttons are present on both listing pages
- [ ] Active category is visually distinct (filled primary button vs outlined)
- [ ] "ทั้งหมด" link goes to `/articles/`
- [ ] Pagination component renders (even if showing "หน้า 1 จาก 1" with 2 articles)
- [ ] Article cards link to correct article pages (`/articles/chatgpt-for-sme/`, `/articles/line-oa-chatbot/`)
- [ ] Empty category pages (case-studies, news) show "ยังไม่มีบทความในหมวดนี้"

## Plan Verification

- [ ] `npm run build` completes without errors
- [ ] Full end-to-end browsing flow works: `/articles/` -> click card -> `/articles/{slug}/` -> "กลับไปหน้าบทความ" -> back to listing
- [ ] Category flow works: `/articles/` -> click category filter -> `/articles/category/{cat}/` -> click card -> article page
- [ ] Header "Articles" nav link goes to `/articles/` (already wired in Header.astro from Phase 1)
- [ ] All pages have proper SEO meta tags (canonical, OG) from BaseLayout
- [ ] RSS feed still works: `dist/rss.xml` has entries
- [ ] Sitemap still works: `dist/sitemap-index.xml` exists
- [ ] Cards display Thai text correctly with proper truncation
- [ ] Dark mode works on all new pages (listing, category, article)
- [ ] Mobile responsive: cards stack to single column on mobile
